{#
  partials/k8s_records_table.html

  Displays hostnames discovered from Kubernetes Ingress resources.
  Each row shows the hostname, namespace, Ingress name, and a "+ Manage"
  button to add the hostname to the Cloudflare DDNS managed list.

  Context variables:
    k8s_records  — list of IngressRecord dataclass instances
    k8s_error    — error string if discovery failed, or None
    managed_names — list of FQDNs already in the managed records list
#}

{% if k8s_error %}
<div class="alert" style="background:#fef3c7; color:#92400e; border:1px solid #fde68a;
     display:flex; align-items:center; gap:0.75rem; margin-bottom:0.75rem;">
  <span style="font-size:1.125rem;">&#9888;</span>
  <div><strong>Kubernetes discovery error</strong> &mdash; {{ k8s_error }}</div>
</div>
{% endif %}

{% if k8s_records %}
<table>
  <thead>
    <tr>
      <th>Hostname</th>
      <th>Namespace</th>
      <th>Ingress</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    {% for r in k8s_records %}
    <tr>
      <td class="font-mono text-sm">{{ r.hostname }}</td>
      <td class="text-muted text-sm">{{ r.namespace }}</td>
      <td class="text-muted text-sm">{{ r.ingress_name }}</td>
      <td>
        {% if r.hostname not in managed_names %}
        <form hx-post="/add-to-managed"
              hx-target="#records-container"
              hx-swap="innerHTML"
              hx-on:htmx:after-request="if(event.detail.successful) location.reload()"
              style="display:inline">
          <input type="hidden" name="record_name" value="{{ r.hostname }}">
          <button type="submit" class="btn btn-primary btn-sm">+ Manage</button>
        </form>
        {% else %}
        <span class="badge badge-ok">Managed</span>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% elif not k8s_error %}
<p class="text-muted text-sm">No Ingress hostnames found in the cluster.</p>
{% endif %}
